package com.example.malwaredetectionapp.network

import android.content.Context
import okhttp3.OkHttpClient
import retrofit2.Retrofit
import retrofit2.converter.gson.GsonConverterFactory

object RetrofitClient {
    private const val BASE_URL = "https://10.0.2.2:5000/"
    // Tạo một OkHttpClient với cấu hình mặc định.
    private val okHttpClient = OkHttpClient.Builder().build()
    private val retrofit: Retrofit by lazy {
        Retrofit.Builder()
            // Thiết lập địa chỉ URL cơ sở cho tất cả các yêu cầu API được tạo bởi Retrofit này.
            .baseUrl(BASE_URL)
            // Sử dụng đối tượng okHttpClient để thực hiện các yêu cầu HTTP.
            .client(CustomTrustManager.getOkHttpClient(ContextHolder.context))
            // Giúp Retrofit chuyển đổi dữ liệu JSON thành các đối tượng Kotlin/Java và ngược lại.
            .addConverterFactory(GsonConverterFactory.create())
            .build()
    }
    // Instan của ApiService cho các hoạt động upload file
    val apiService: ApiService by lazy {
        retrofit.create(ApiService::class.java)
    }
    // Instance của AuthService cho các hoạt động có xác thực (đăng ký, đăng nhập)
    val authService: AuthService by lazy {
        retrofit.create(AuthService::class.java)
    }
}

object ContextHolder {
    lateinit var context: Context
}